{% extends 'cbase.html' %}
{% load static %}
{% block content %}

<!-- ===================== IMAGE BANNER CAROUSEL ===================== -->
<div class="relative overflow-hidden h-[220px] sm:h-[300px] md:h-[380px]">
    <div id="carousel" class="flex h-full transition-transform duration-700">

        <!-- Slide 1 -->
        <div class="min-w-full relative">
            <img src="https://cdn.pixabay.com/photo/2020/07/08/04/12/work-5382501_640.jpg"
                class="w-full h-full object-cover">
            <div class="absolute inset-0 bg-black/50 flex items-center justify-center text-center text-white px-4">
                <div>
                    <h1 class="text-2xl sm:text-4xl font-extrabold mb-3">
                        Find Your Dream Job
                    </h1>
                    <p class="text-sm sm:text-lg opacity-90">
                        Explore thousands of verified opportunities
                    </p>
                </div>
            </div>
        </div>

        <!-- Slide 2 -->
        <div class="min-w-full relative">
            <img src="https://eduauraapublic.s3.ap-south-1.amazonaws.com/webassets/images/blogs/highest-paying-jobs-in-india.jpg"
                class="w-full h-full object-cover">
            <div class="absolute inset-0 bg-black/50 flex items-center justify-center text-center text-white px-4">
                <div>
                    <h1 class="text-2xl sm:text-4xl font-extrabold mb-3">
                        Remote • Hybrid • Onsite
                    </h1>
                    <p class="text-sm sm:text-lg opacity-90">
                        Jobs that fit your lifestyle
                    </p>
                </div>
            </div>
        </div>

        

    </div>
</div>



<!-- ===================== SEARCH ===================== -->
<div class="max-w-5xl mx-auto -mt-10 sm:-mt-12 mb-12 relative z-10 px-4">
    <form method="get" class="bg-white rounded-2xl shadow-xl border p-4 sm:p-6">
        <div class="flex flex-col sm:flex-row gap-3">
            <input type="text" name="search" value="{{ search|default:'' }}" placeholder="Job title, skill, keyword"
                class="flex-1 px-4 py-3 rounded-xl border focus:outline-none">
            <button class="bg-blue-600 text-white px-8 py-3 rounded-xl font-semibold">
                Search
            </button>
        </div>
    </form>
</div>



<!-- Messages -->
{% if messages %}
<div class="space-y-3 my-8 w-[70%] mx-auto">
    {% for message in messages %}
    <div class="flex items-center justify-between gap-3 px-4 py-3 rounded-lg text-sm font-medium relative
                {% if message.tags == 'success' %} bg-green-100 text-green-700 border border-green-200
                {% elif message.tags == 'error' %} bg-red-100 text-red-700 border border-red-200
                {% else %} bg-blue-100 text-blue-700 border border-blue-200 {% endif %}">
        
        <div class="flex items-center gap-2">
            <i data-lucide="{% if message.tags == 'success' %}check-circle{% else %}alert-circle{% endif %}"
               class="w-4 h-4"></i>
            <span>{{ message }}</span>
        </div>

        <!-- Close Button -->
        <button onclick="this.parentElement.remove()"
                class="text-gray-500 hover:text-gray-700">
            <i data-lucide="x" class="w-4 h-4"></i>
        </button>
    </div>
    {% endfor %}
</div>
{% endif %}



<!-- ===================== JOB COUNT ===================== -->
<div class="max-w-7xl mx-auto px-4 flex flex-col sm:flex-row gap-3 justify-between items-start sm:items-center mb-6">
    <p class="text-sm text-gray-600">
        <span class="font-semibold text-gray-900">{{ total_jobs }}</span> jobs found
    </p>
    <button onclick="openFilters()" class="group inline-flex items-center gap-2
           bg-gradient-to-r from-blue-600 to-indigo-600
           text-white px-5 py-2.5 rounded-xl text-sm font-semibold
           shadow-md hover:shadow-lg
           hover:from-blue-700 hover:to-indigo-700
           focus:outline-none focus:ring-2 focus:ring-blue-300
           transition-all duration-300">

        <!-- Icon -->
        <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4 transition-transform duration-300 group-hover:rotate-90"
            fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2a1 1 0 01-.293.707L15 12.414V19a1 1 0 01-1.447.894l-4-2A1 1 0 019 17.999v-5.585L3.293 6.707A1 1 0 013 6V4z" />
        </svg>

        <!-- Text -->
        Filters
    </button>

</div>

<!-- ===================== JOB LIST ===================== -->
<div class="max-w-7xl mx-auto px-4 space-y-5">

    {% for job in page_obj %}
    <div class="bg-blue-50 border rounded-2xl p-5 sm:p-6 hover:shadow-lg transition">

        <div class="flex flex-col sm:flex-row gap-4">
            <!-- Logo -->
            <div
                class="w-12 h-12 sm:w-14 sm:h-14 bg-blue-600 rounded-xl flex items-center justify-center text-white text-lg font-bold">
                {{ job.company|slice:":1"|upper }}
            </div>

            <div class="flex-1">
                <h3 class="text-lg sm:text-xl font-bold">{{ job.title }}</h3>
                <p class="text-sm text-gray-600">{{ job.company }}</p>

                <!-- Meta -->
                <div class="flex flex-wrap gap-4 text-sm text-gray-600 mt-2">
                    <span>{{ job.location }}</span>
                    <span>{{ job.get_job_type_display }}</span>
                </div>

                <!-- Skills -->
                <div class="flex flex-wrap gap-2 mt-3">
                    {% if job.skill_1 %}<span class="skill">{{ job.skill_1 }}</span>{% endif %}
                    {% if job.skill_2 %}<span class="skill">{{ job.skill_2 }}</span>{% endif %}
                    {% if job.skill_3 %}<span class="skill">{{ job.skill_3 }}</span>{% endif %}
                    {% if job.skill_4 %}<span class="skill">{{ job.skill_4 }}</span>{% endif %}
                    {% if job.skill_5 %}<span class="skill">{{ job.skill_5 }}</span>{% endif %}
                </div>

                <!-- Footer -->
                <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 mt-5 pt-4 border-t">
                    <p class="text-xs text-gray-500">
                        Posted {{ job.created_at|timesince }} ago · {{ job.applications.count }} applicants
                    </p>

                    <div class="flex flex-wrap gap-2">
                        <a href="{% url 'candidate-jobdetail' job.id %}" class="px-4 py-2 border rounded-lg text-sm">
                            Job Details
                        </a>

                        {% if job.id in applied_job_ids %}
                        <span class="px-4 py-2 bg-gray-300 rounded-lg text-sm">
                            Applied
                        </span>
                        {% else %}
                        <a href="{% url 'candidate-jobapply' job.id %}"
                            class="px-4 py-2 bg-blue-600 text-white rounded-lg text-sm">
                            Apply Now
                        </a>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% empty %}
    <p class="text-center text-gray-500 py-20">No jobs found.</p>
    {% endfor %}

</div>

<!-- ===================== FILTER MODAL ===================== -->
<div id="filterModal" class="fixed inset-0 bg-black/50 hidden z-50 px-4">
    <form method="get" class="bg-white max-w-lg mx-auto mt-20 p-6 rounded-2xl space-y-4">
        <h2 class="text-xl font-bold">Filters</h2>

        <select name="category" class="w-full border p-3 rounded">
            <option value="">All Categories</option>
            {% for cat in categories %}
            <option value="{{ cat.id }}">{{ cat.name }}</option>
            {% endfor %}
        </select>

        <select name="job_type" class="w-full border p-3 rounded">
            <option value="">All Job Types</option>
            <option value="remote">Remote</option>
            <option value="hybrid">Hybrid</option>
            <option value="onsite">Onsite</option>
        </select>

        <div class="flex justify-end gap-3">
            <button type="button" onclick="closeFilters()" class="px-4 py-2 border rounded">
                Cancel
            </button>
            <button class="px-6 py-2 bg-blue-600 text-white rounded">
                Apply
            </button>
        </div>
    </form>
</div>

<!-- ===================== SCRIPTS ===================== -->
<script>
    let index = 0;
    setInterval(() => {
        index = (index + 1) % 2;
        document.getElementById('carousel').style.transform =
            `translateX(-${index * 100}%)`;
    }, 4000);

    function openFilters() {
        document.getElementById('filterModal').classList.remove('hidden');
    }
    function closeFilters() {
        document.getElementById('filterModal').classList.add('hidden');
    }
</script>

<style>
    .skill {
        font-size: 12px;
        background: #e0f2fe;
        color: #0369a1;
        padding: 4px 10px;
        border-radius: 8px;
        font-weight: 500;
    }
</style>

{% endblock %}